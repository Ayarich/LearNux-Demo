{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Leaderboard | {{ path.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
  />

  <style>
    body {
      background:#020617;
      color:#e5e7eb;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      padding:2rem;
    }

    .page-shell {
      max-width: 960px;
      margin: 0 auto;
    }

    .header-card {
      background:#020617;
      border-radius:1.25rem;
      border:1px solid rgba(148,163,184,.45);
      padding:1.4rem 1.6rem;
      margin-bottom:1.5rem;
      box-shadow:0 20px 45px -20px rgba(15,23,42,.8);
    }

    .pill {
      display:inline-flex;
      align-items:center;
      gap:.4rem;
      font-size:.75rem;
      padding:.25rem .7rem;
      border-radius:999px;
      border:1px solid rgba(52,211,153,.5);
      color:#bbf7d0;
      background:rgba(6,95,70,.4);
      margin-bottom:.6rem;
    }

    .leaderboard-card {
      background:#020617;
      border-radius:1rem;
      border:1px solid rgba(148,163,184,.35);
      padding:1.1rem 1.2rem;
    }

    table {
      font-size:.9rem;
    }

    thead tr {
      border-color:rgba(148,163,184,.5) !important;
    }

    tbody tr {
      border-color:rgba(30,41,59,.9);
    }

    tbody tr:nth-child(1) {
      background:linear-gradient(90deg,rgba(234,179,8,.08),rgba(15,23,42,1));
    }

    tbody tr:nth-child(2) {
      background:linear-gradient(90deg,rgba(148,163,184,.12),rgba(15,23,42,1));
    }

    tbody tr:nth-child(3) {
      background:linear-gradient(90deg,rgba(56,189,248,.09),rgba(15,23,42,1));
    }

    .rank-badge {
      width:28px;
      height:28px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:.8rem;
      font-weight:600;
      background:rgba(15,23,42,1);
      border:1px solid rgba(148,163,184,.6);
      color:#e5e7eb;
    }

    .rank-1 { border-color:#facc15; color:#facc15; }
    .rank-2 { border-color:#e5e7eb; color:#e5e7eb; }
    .rank-3 { border-color:#38bdf8; color:#38bdf8; }

    .score-pill {
      font-size:.78rem;
      border-radius:999px;
      padding:2px 8px;
      background:rgba(37,99,235,.15);
      border:1px solid rgba(37,99,235,.7);
      color:#bfdbfe;
    }

    .badge-count-pill {
      font-size:.75rem;
      border-radius:999px;
      padding:2px 7px;
      background:rgba(22,163,74,.12);
      border:1px solid rgba(22,163,74,.7);
      color:#bbf7d0;
    }

    .subtitle {
      font-size:.85rem;
      color:#9ca3af;
    }

    @media (max-width: 768px) {
      body {
        padding:1.25rem;
      }
      .header-card {
        padding:1.1rem 1.2rem;
      }
      table {
        font-size:.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="page-shell">
    <div class="header-card">
      <div class="d-flex justify-content-between flex-wrap gap-3 align-items-start">
        <div>
          <div class="pill">
            <i class="bi bi-trophy-fill"></i>
            <span>Linux Lab Leaderboard</span>
          </div>
          <h1 class="h5 mb-1">Top learners</h1>
          <p class="subtitle mb-0">
            Ranked by completed tasks and badges in {{ path.title }}.
          </p>
        </div>
        <div class="text-md-end">
          <div class="subtitle mb-2">
            Want to climb the board?<br/>
            Complete more tasks & earn badges.
          </div>
          <a href="{% url 'serverconsole:linux-path' %}" class="btn btn-outline-light btn-sm">
            <i class="bi bi-list-task me-1"></i> View lessons
          </a>
        </div>
      </div>
    </div>

    <div class="leaderboard-card">
      {% if leaderboard %}
        <div class="table-responsive">
          <table class="table table-borderless align-middle mb-0">
            <thead class="border-bottom">
              <tr class="text-muted">
                <th style="width:60px;">Rank</th>
                <th>Learner</th>
                <th class="text-center">Tasks completed</th>
                <th class="text-center">Badges</th>
                <th class="text-end">Score</th>
              </tr>
            </thead>
            <tbody>
              {% for row in leaderboard %}
                <tr>
                  <td>
                    {% with rank=forloop.counter %}
                      <div class="rank-badge
                        {% if rank == 1 %}rank-1{% elif rank == 2 %}rank-2{% elif rank == 3 %}rank-3{% endif %}">
                        {{ rank }}
                      </div>
                    {% endwith %}
                  </td>
                  <td>
                    <div class="fw-semibold">{{ row.user.username }}</div>
                    <div class="subtitle">
                      {% if request.user == row.user %}
                        You ðŸ’š
                      {% else %}
                        Active Linux learner
                      {% endif %}
                    </div>
                  </td>
                  <td class="text-center">
                    {{ row.tasks_completed }}
                  </td>
                  <td class="text-center">
                    <span class="badge-count-pill">
                      <i class="bi bi-award me-1"></i>{{ row.badges_count }}
                    </span>
                  </td>
                  <td class="text-end">
                    <span class="score-pill">
                      {{ row.score }} pts
                    </span>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="subtitle mb-0">
          No progress yet. Be the first to complete a lesson and youâ€™ll appear here.
        </p>
      {% endif %}
    </div>

    <div class="mt-3 d-flex flex-wrap gap-2">
      <a href="{% url 'serverconsole:console' %}" class="btn btn-primary btn-sm">
        <i class="bi bi-terminal me-1"></i> Open Terminal
      </a>
      <a href="{% url 'serverconsole:linux-path' %}" class="btn btn-outline-light btn-sm">
        Back to Learning Path
      </a>
    </div>
  </div>
</body>
</html>
